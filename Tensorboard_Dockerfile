FROM continuumio/miniconda3 AS builder

RUN /opt/conda/bin/conda init bash && \
    /bin/bash -c "source /opt/conda/etc/profile.d/conda.sh && \
    conda create -n tensorboard python=3.11 -y && \
    conda activate tensorboard && \
    pip install tensorboard && \
    pip install six && \
    conda clean -afy"

RUN mkdir /app && \
    cp -r /opt/conda /app/conda

FROM continuumio/miniconda3

ENV PATH=/opt/conda/bin:$PATH

COPY --from=builder /app/conda /opt/conda

WORKDIR /moai

SHELL ["/bin/bash", "-c"]
RUN echo "source /opt/conda/etc/profile.d/conda.sh && conda activate tensorboard" >> /root/.bashrc

CMD ["/bin/bash"]

VOLUME ["/moai"]